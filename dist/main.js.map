{"mappings":"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","sources":["index.js","utils.js"],"sourcesContent":["import { AnalyticsBrowser, Context } from \"@segment/analytics-next\";\nimport {\n  getCustomerInfo,\n  formatCheckoutData,\n  formatProductData,\n  formatEventName,\n} from \"./utils.js\";\n\nconst segment = (window.segment = AnalyticsBrowser.load({\n  writeKey: \"bevOsoWqV9duPDtFxcCpLG7DJQbKdbLM\",\n}));\n\nconsole.log(segment);\nfunction initialize() {\n  const analytics = window.analytics;\n  const browser = window.browser;\n\n  analytics.subscribe(\"checkout_started\", (event) => {\n    segment.track(\n      formatEventName(event.name),\n      formatCheckoutData(event.data.checkout)\n    );\n  });\n\n  analytics.subscribe(\"checkout_completed\", (event) => {\n    const eventData = {\n      affiliation: \"Website\",\n      checkout_id: event.data.checkout.token,\n      coupon: event.data.checkout.discountApplications,\n      currency: event.data.checkout.currencyCode,\n      discount: event.data.checkout.discountApplications,\n      products: formatProductData(event.data.checkout.lineItems),\n      brand: event.data.checkout.lineItems[0].variant.product.vendor,\n      category: event.data.checkout.lineItems[0].variant.product.type,\n      image_url: event.data.checkout.lineItems[0].variant.image.src,\n      name: event.data.checkout.lineItems[0].variant.product.title,\n      price: event.data.checkout.lineItems[0].variant.price.amount,\n      product_id: event.data.checkout.lineItems[0].variant.product.id,\n      quantity: event.data.checkout.lineItems[0].quantity,\n      sku: event.data.checkout.lineItems[0].variant.sku,\n      subscription: !!event.data.checkout.lineItems[0].selling_plan_allocation,\n      url: `${window.location.hostname}${event.data.checkout.lineItems[0].variant.product.url}`,\n      value: (\n        event.data.checkout.lineItems[0].variant.price.amount *\n        event.data.checkout.lineItems[0].quantity\n      ).toFixed(2),\n      variant: event.data.checkout.lineItems[0].variant.title,\n      source: \"becausemarket.com\",\n    };\n\n    segment.track(formatEventName(event.name), eventData);\n  });\n\n  analytics.subscribe(\"page_viewed\", async (event) => {\n    let pageData;\n    const { navigator, document } = event;\n\n    if (document && navigator) {\n      pageData = {\n        title: document.title,\n        path: document.location.pathname,\n        referrer: document.referrer,\n        search: document.location.search,\n        url: document.location.href,\n        keywords: [],\n        userAgent: navigator.userAgent,\n        userAgentData: [],\n      };\n    }\n    const eventData = {\n      ...(await getCustomerInfo()),\n      ...pageData,\n    };\n\n    segment.page(formatEventName(event.name), eventData);\n  });\n}\n\nif (document.readyState === \"loading\") {\n  // If document is still loading\n  document.addEventListener(\"DOMContentLoaded\", initialize); // Wait for it to finish loading before running initialize\n} else {\n  // Otherwise, if document has already loaded\n  initialize(); // Run initialize immediately\n}\n","const traitKey = \"ajs_user_traits\";\n\nexport const formatEventName = (name) => {\n  return name\n    .split(\"_\")\n    .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n    .join(\" \");\n};\n\nexport const formatProductData = (products) =>\n  products.map((product) => ({\n    brand: product.variant.product.vendor,\n    category: product.variant.product.type,\n    coupon: product.discountAllocations,\n    image_url: product.variant.image.src,\n    name: product.variant.product.title,\n    price: product.variant.price.amount,\n    product_id: product.variant.product.id,\n    quantity: product.quantity,\n    sku: product.variant.sku,\n    subscription: null,\n    variant: product.variant.title,\n    url: `${window.location.hostname}${product.variant.product.url}`,\n    value: (product.variant.price.amount * product.quantity).toFixed(2),\n  }));\n\nconst formatProductData2 = (product) => ({\n  brand: product.vendor,\n  category: product.product_type,\n  coupon: product.discounts,\n  image_url: product.image.substring(2),\n  name: product.product_title,\n  position: null,\n  price: formatProductPrice(product.line_price),\n  product_id: product.id,\n  quantity: product.quantity,\n  sku: product.sku,\n  subscription: !!product.selling_plan_allocation,\n  variant: product.variant_title,\n  variant_id: product.variant_id,\n  url: `${window.location.hostname}${product.url}`,\n});\n\nexport const formatCheckoutData = (checkout) => {\n  const {\n    lineItems,\n    currencyCode: currency,\n    discountApplications: coupon,\n    token: checkout_id,\n  } = checkout;\n\n  return {\n    affiliation: \"Website\",\n    source: \"becausemarket.com\",\n    coupon,\n    discount: coupon,\n    currency,\n    checkout_id,\n    products: formatProductData(lineItems),\n  };\n};\n\nexport const getCustomerInfo = async () => {\n  const customer = JSON.parse(await browser.localStorage.getItem(traitKey));\n\n  return {\n    email: customer.email,\n    first_name: customer.firstName,\n    last_name: customer.lastName,\n  };\n};\n"],"names":[],"version":3,"file":"main.js.map"}